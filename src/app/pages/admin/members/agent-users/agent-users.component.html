<main id="main" class="main">
	<div class="pagetitle">
		<h1>Agents</h1>
		<nav>
			<ol class="breadcrumb">
				<li class="breadcrumb-item">
					<a routerLink="/admin/dashboard">Admin</a>
				</li>
				<li class="breadcrumb-item">Members</li>
				<li class="breadcrumb-item active">Agents</li>
			</ol>
		</nav>
	</div>
	<!-- End Page Title -->

	<section class="section">
		<div class="row">
			<div class="col-lg-12">
				<div class="card">
					<div class="card-body">
						<div class="col-md-6 text-left">
							<div
								class="spinner-border text-primary"
								role="status"
								*ngIf="isDisplayed"
							></div>
						</div>
						<div class="row">
							<div class="col-md-2 py-4 mt-1 pe-0">
								<div class="dataTables_length">
									<label
										>Show
										<select
											[(ngModel)]="itemsPerPage"
											(change)="userList()"
										>
											<option value="5">5</option>
											<option value="10">10</option>
											<option value="20">20</option>
											<option value="50">50</option>
											<option value="100">100</option>
										</select>
										entries</label
									>
								</div>
							</div>
							<div class="col-lg-2 py-4 px-0 text-start">
								<input
									type="text"
									[(ngModel)]="searchTerm"
									(keyup)="search(usersList)"
									placeholder="Search"
									class="form-control rounded"
								/>
							</div>

							<div
								class="col-md-8 py-4 text-end"
								*ngIf="
									userProfile?.userDetail?.userRoles !=
									'Partner'
								"
							>
								<button
									type="button"
									routerLink="/admin/agent-users/add"
									class="btn btn-primary"
								>
									Add Agent
								</button>
							</div>
						</div>
						<table
							class="table table-striped table-bordered"
							id="dash-all-transactions"
						>
							<thead>
								<th>#</th>
								<th>Full Name</th>
								<th>Email</th>
								<th>Phone</th>
								<th>Pin</th>
								<th>Merchant</th>
								<th>Action</th>
							</thead>
							<tbody>
								<tr
									*ngFor="
										let item of displayedData;
										let i = index
									"
								>
									<td>{{ i + 1 }}</td>
									<td>{{ item.full_name }}</td>
									<td>{{ item.email }}</td>
									<td>{{ item.phone }}</td>
									<td>{{ item.pin_code }}</td>
									<td>
										<button
											type="button"
											class="btn btn-primary btn-sm"
											(click)="open(mymodal, item)"
											*ngIf="!item?.merchant_id"
										>
											Assign
										</button>
										<span *ngIf="item?.email"
											>{{ item?.merchant_email }}
										</span>
										<button
											type="button"
											class="btn btn-danger btn-sm"
											(click)="
												removeMerchant(
													item?.id,
													item?.merchant_id
												)
											"
											*ngIf="item?.merchant_id"
										>
											Remove
										</button>
									</td>
									<td>
										<a
											
											class="action-icons pe-2"
											(click)="open(changePassword, item)"
											><i class="bi bi-key" style="zoom: 1.3"></i>
										</a>
										<a
											routerLink="/admin/agent-users/edit/{{
												item?.id
											}}"
											class="action-icons pe-2"
											*ngIf="
												userProfile?.userDetail
													?.userRoles != 'Partner'
											"
											><i class="bi bi-pencil-square"></i
										></a>
									</td>
								</tr>
							</tbody>
						</table>
						<div
							class="text-center recordnotfound"
							*ngIf="displayedData.length == 0"
						>
							Record not found
						</div>
						<app-pagination
							[allPagesNumber]="allPages"
							(changePage)="onPageChange($event)"
						>
						</app-pagination>
						<!-- End Table with stripped rows -->
					</div>
				</div>
			</div>
		</div>
	</section>
</main>
<ng-template #mymodal let-modal>
	<div class="modal-header">
		<div
			class="close"
			aria-label="Close"
			(click)="modal.dismiss('Cross click')"
		>
			<span aria-hidden="true">×</span>
		</div>
	</div>
	<div class="modal-body">
		<form
			class="row g-3"
			[formGroup]="form"
			#f="ngForm"
			(submit)="addMerchant(f.value)"
		>
			<div class="col-12">
				<label for="inputNanme4" class="form-label"
					>Select Merchant</label
				>
				<select
					class="form-select requiredField"
					formControlName="merchant_id"
				>
					<option selected disabled value="">Choose...</option>

					<option
						*ngFor="let item of merchantList"
						[value]="item?.id"
					>
						{{ item?.email }}
					</option>
				</select>
			</div>
			<div class="text-end">
				<button type="submit" class="btn btn-primary">Add</button>
			</div>
		</form>
		<!-- Vertical Form -->
	</div>
</ng-template>
<ng-template #changePassword let-modal>
	<div class="modal-header">
		
		<div
			class="close"
			aria-label="Close"
			(click)="modal.dismiss('Cross click')"
		>
			<span aria-hidden="true">×</span>
		</div>
	</div>
	<div class="modal-body">
		<div>	
			<h4>Change Password</h4>	
		</div>
		
		<form
			class="row g-3"
			[formGroup]="changePasswordForm"
			(submit)="changePass()"
		>
			<div class="col-12">
				<label for="inputNanme4" class="form-label">Password</label>
				<input
					type="text"
					formControlName="new_password"
					class="form-control requiredField"
					id="validationDefault01"
					value=""
				/>
			</div>
			<div class="col-12">
				<label for="inputNanme4" class="form-label"
					>Confirm Password</label
				>
				<input
					type="text"
					formControlName="confirm_password"
					class="form-control requiredField"
					id="validationDefault01"
					value=""
				/>
			</div>
			<div class="text-end">
				<button type="submit" class="btn btn-primary">Change Password</button>
			</div>
		</form>
		<!-- Vertical Form -->
	</div>
</ng-template>
